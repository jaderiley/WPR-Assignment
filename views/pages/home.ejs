<%- include('../partials/header') %>

<div class="welcome-banner">
  WELCOME TO PIXELVERSE!
</div>

<% if (nextEvent) { %>
  <div class="game-container countdown-container">
    <div class="game-header">
      <span class="game-title">NEXT EVENT</span>
    </div>
    <div class="game-content">
      <div class="countdown">
        <h3 class="event-title"><%= nextEvent.title %></h3>
        <div class="countdown-timer">
          <span id="timer"></span>
        </div>
        <div class="event-details">
          <p>Date: <%= new Date(nextEvent.date).toLocaleDateString() %></p>
          <p>Location: <%= nextEvent.location %></p>
        </div>
      </div>
    </div>
  </div>
<% } else { %>
  <div class="game-container countdown-container">
    <div class="game-header">
      <span class="game-title">NEXT EVENT</span>
    </div>
    <div class="game-content">
      <div class="countdown">
        <p>No upcoming events scheduled</p>
      </div>
    </div>
  </div>
<% } %>

<!-- Updated Events Section -->
<div class="game-container events-container">
  <div class="game-header">
    <span class="game-title">UPCOMING EVENTS</span>
  </div>
  <div class="game-content">
    <div class="event-grid">
      <% upcomingEvents.forEach(event => { %>
        <div class="event-card"
             style="background-image: url('<%= event.image %>');
                    background-size: cover;
                    background-position: center;
                    background-repeat: no-repeat;">
          <div class="content">
            <h3 class="event-title"><%= event.title %></h3>
            <p class="event-date"><%= event.date %></p>
            <p class="event-location"><%= event.location %></p>
            <p class="event-description"><%= event.description %></p>
          </div>
        </div>
      <% }); %>
    </div>
  </div>
</div>

<% if (nextEvent) { %>
  <div id="countdown-data" data-event-date="<%= nextEvent.date %>" style="display:none;"></div>
<% } %>

<script>
  const countdownData = document.getElementById('countdown-data');
  if (countdownData) {
    const eventDate = new Date(countdownData.dataset.eventDate).getTime();
    function updateCountdown() {
      const now = new Date().getTime();
      const distance = eventDate - now;
      const days = Math.floor(distance / (1000 * 60 * 60 * 24));
      const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
      const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
      const seconds = Math.floor((distance % (1000 * 60)) / 1000);
      document.getElementById('timer').innerHTML = 
        `${days}d ${hours}h ${minutes}m ${seconds}s`;
      if (distance < 0) {
        clearInterval(countdownInterval);
        document.getElementById('timer').innerHTML = "EVENT STARTED!";
      }
    }
    updateCountdown();
    const countdownInterval = setInterval(updateCountdown, 1000);
  }
</script>

<%- include('../partials/footer') %>
